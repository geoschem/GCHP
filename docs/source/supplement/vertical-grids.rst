.. _gchp-vgrids:

###################
GCHP vertical grids
###################

On this page we provide information about the vertical grid used by GCHP.

.. _gchp-grids-hybrid:

======================
Hybrid grid definition
======================

A hybrid sigma-pressure grid (aka :math:`\eta` grid) uses a
terrain-following coordinate near the surface, which then transitions
to a purely fixed-pressure coordinate.

The pressure at the bottom edge of grid box :math:`(I,J,L)` of a
hybrid grid may be defined as:

.. math::

   P_{edge}(I,J,L) = A_p(L) + B_p(L) \times P_{surface}(I,J)

where

- :math:`(I,J,L)` are the lon, lat, and level indices of the grid box;
- :math:`P_{surface}(I,J)` is the "true" surface pressure at lon,lat
  location :math:`(I,J)`;
- :math:`A_p(L)` are constants in surface pressure units (Pa or hPa), defined at level edges;
- :math:`B_p(L)` are unitless constants, defined at level edges.

The values of :math:`A_p(L)` and :math:`B_p(L)` specify the vertical
properties of the grid.  In GEOS-Chem, you may find these values in
source code file :file:`GeosUtil/pressure_mod.F90`.

The pressure at the vertical midpoint of grid box :math:`(I,J,L)` is
computed as the average of the pressures at successive vertical edges:

.. math::

   P_{midpoint}(I,J,L) = \frac{P_{edge}(I,J,L) + P_{edge}(I,J,L+1)}{2}

An :math:`\eta` coordinate can be constructed from
:math:`P_{edge}(I,J,L)` and :math:`P_{midpoint}(I,J,L)` as follows:

.. math::

   \eta_{edge}(I,J,L) = \frac{P_{edge}(I,J,L) - P_{top}}{P_{surface}(I,J) - P_{top}}

.. math::

   \eta_{midpoint}(I,J,L) = \frac{P_{midpoint}(I,J,L) - P_{top}}{P_{surface}(I,J) - P_{top}}

where :math:`P_{top}` is pressure at the top level of the vertical
grid.


Specifics for GMAO vertical grids
---------------------------------

The the :math:`P_{edge}(I,J,L)` and :math:`P_{midpoint}(I,J,L)` values
in GMAO meteorological products vary with the topography up to 170
hPa.  Skyward of 170 hPa, :math:`P_{edge}(I,J,L)` and
:math:`P_{midpoint}(I,J,L)` remain constant for all longitudes and
latitudes :math:`(I,J)`.  GMAO meteorological products use a model top
of 0.01 hPa.

.. _gchp-vgrids_gmao:

===================================
Vertical grids for GMAO meteorology
===================================

.. _gchp-vgrids-gmao-72:

72-level vertical grid
----------------------

This grid is used by the `GEOS-FP
<https://wiki.seas.harvard.edu/geos-chem/index.php?title=GEOS-FP>`_,
`GEOS-IT
<https://wiki.seas.harvard.edu/geos-chem/index.php?title=GEOS-IT>`_,
and `MERRA-2
<https://wiki.seas.harvard.edu/geos-chem/index.php?title=MERRA-2>`_
meteorological field products from NASA GMAO.  It has 72 vertical
levels and 73 edges.

.. _gchp-vgrids-gmao-72-ind:

Indexing
~~~~~~~~

GCHP assumes :literal:`positive:down` indexing, where the surface is
denoted as level 72 and top-of-atmosphere is denoted as level 1.  The
GCHP infrastructure flips input data in the vertical dimension before
passing it to the GEOS-Chem science routines (which assume
:literal:`positive:up` indexing).

.. _gchp-vgrids-gmao-72-ab:

:math:`A_p` and :math:`B_p`
~~~~~~~~~~~~~~~~~~~~~~~~~~~

The table below lists the :math:`A_p` and :math:`B_p` parameters that
define the 72-level vertical grid.

.. list-table::
   :header-rows: 1

   * - :literal:`positive:down` level edge index
     - :literal:`positive:up` level edge index
     - :math:`A_p` (hPa)
     - :math:`B_p` (unitless)
   * - 73
     - 1
     - 0.0
     - 1.0
   * - 72
     - 2
     - 0.04804826
     - 0.984952
   * - 71
     - 3
     - 6.593752
     - 0.963406
   * - 70
     - 4
     - 13.1348
     - 0.941865
   * - 69
     - 5
     - 19.61311
     - 0.920387
   * - 68
     - 6
     - 26.09201
     - 0.898908
   * - 67
     - 7
     - 32.57081
     - 0.877429
   * - 66
     - 8
     - 38.98201
     - 0.856018
   * - 65
     - 9
     - 45.33901
     - 0.8346609
   * - 64
     - 10
     - 51.69611
     - 0.8133039
   * - 63
     - 11
     - 58.05321
     - 0.7919469
   * - 62
     - 12
     - 64.36264
     - 0.7706375
   * - 61
     - 13
     - 70.62198
     - 0.7493782
   * - 60
     - 14
     - 78.83422
     - 0.721166
   * - 59
     - 15
     - 89.09992
     - 0.6858999
   * - 58
     - 16
     - 99.36521
     - 0.6506349
   * - 57
     - 17
     - 109.1817
     - 0.6158184
   * - 56
     - 18
     - 118.9586
     - 0.5810415
   * - 55
     - 19
     - 128.6959
     - 0.5463042
   * - 54
     - 20
     - 142.91
     - 0.4945902
   * - 53
     - 21
     - 156.26
     - 0.4437402
   * - 52
     - 22
     - 169.609
     - 0.3928911
   * - 51
     - 23
     - 181.619
     - 0.3433811
   * - 50
     - 24
     - 193.097
     - 0.2944031
   * - 49
     - 25
     - 203.259
     - 0.2467411
   * - 48
     - 26
     - 212.15
     - 0.2003501
   * - 47
     - 27
     - 218.776
     - 0.1562241
   * - 46
     - 28
     - 223.898
     - 0.1136021
   * - 45
     - 29
     - 224.363
     - 0.06372006
   * - 44
     - 30
     - 216.865
     - 0.02801004
   * - 43
     - 31
     - 201.192
     - 0.006960025
   * - 42
     - 32
     - 176.93
     - 8.175413e-09
   * - 41
     - 33
     - 150.393
     - 0.0
   * - 40
     - 34
     - 127.837
     - 0.0
   * - 39
     - 35
     - 108.663
     - 0.0
   * - 38
     - 36
     - 92.36572
     - 0.0
   * - 37
     - 37
     - 78.51231
     - 0.0
   * - 36
     - 38
     - 66.60341
     - 0.0
   * - 35
     - 39
     - 56.38791
     - 0.0
   * - 34
     - 40
     - 47.64391
     - 0.0
   * - 33
     - 41
     - 40.17541
     - 0.0
   * - 32
     - 42
     - 33.81001
     - 0.0
   * - 31
     - 43
     - 28.36781
     - 0.0
   * - 30
     - 44
     - 23.73041
     - 0.0
   * - 29
     - 45
     - 19.7916
     - 0.0
   * - 28
     - 46
     - 16.4571
     - 0.0
   * - 27
     - 47
     - 13.6434
     - 0.0
   * - 26
     - 48
     - 11.2769
     - 0.0
   * - 25
     - 49
     - 9.292942
     - 0.0
   * - 24
     - 50
     - 7.619842
     - 0.0
   * - 23
     - 51
     - 6.216801
     - 0.0
   * - 22
     - 52
     - 5.046801
     - 0.0
   * - 21
     - 53
     - 4.076571
     - 0.0
   * - 20
     - 54
     - 3.276431
     - 0.0
   * - 19
     - 55
     - 2.620211
     - 0.0
   * - 18
     - 56
     - 2.08497
     - 0.0
   * - 17
     - 57
     - 1.65079
     - 0.0
   * - 16
     - 58
     - 1.30051
     - 0.0
   * - 15
     - 59
     - 1.01944
     - 0.0
   * - 14
     - 60
     - 0.7951341
     - 0.0
   * - 13
     - 61
     - 0.6167791
     - 0.0
   * - 12
     - 62
     - 0.4758061
     - 0.0
   * - 11
     - 63
     - 0.3650411
     - 0.0
   * - 10
     - 64
     - 0.2785261
     - 0.0
   * - 9
     - 65
     - 0.211349
     - 0.0
   * - 8
     - 66
     - 0.159495
     - 0.0
   * - 7
     - 67
     - 0.119703
     - 0.0
   * - 6
     - 68
     - 0.08934502
     - 0.0
   * - 5
     - 69
     - 0.06600001
     - 0.0
   * - 4
     - 70
     - 0.04758501
     - 0.0
   * - 3
     - 71
     - 0.0327
     - 0.0
   * - 2
     - 72
     - 0.02
     - 0.0
   * - 1
     - 73
     - 0.01
     - 0.0

.. _gchp-vgrids-gmao-72-prs-alt:

Pressures and altitudes
~~~~~~~~~~~~~~~~~~~~~~~

The table below lists pressures and altitudes of the 72 layer grid for
a column at atmospheric sea level.

.. code-block:: text

    L        L     Eta Edge      Eta Mid     Altitude     Pressure
    down     up    (unitless)   (unitless)        (km)        (hPa)
   ===================================================================
                    0.000000                    80.581        0.010
      1      72                  0.000005       78.146        0.015
                    0.000010                    76.357        0.020
      2      71                  0.000016       74.594        0.026
                    0.000022                    73.180        0.033
      3      70                  0.000030       71.812        0.040
                    0.000037                    70.657        0.048
      4      69                  0.000046       69.440        0.057
                    0.000055                    68.392        0.066
      5      68                  0.000067       67.243        0.078
                    0.000078                    66.245        0.089
      6      67                  0.000093       65.115        0.105
                    0.000108                    64.130        0.120
      7      66                  0.000128       63.004        0.140
                    0.000148                    62.021        0.159
      8      65                  0.000173       60.902        0.185
                    0.000199                    59.924        0.211
      9      64                  0.000232       58.816        0.245
                    0.000265                    57.846        0.279
     10      63                  0.000308       56.752        0.322
                    0.000350                    55.794        0.365
     11      62                  0.000405       54.717        0.420
                    0.000460                    53.773        0.476
     12      61                  0.000529       52.716        0.546
                    0.000599                    51.788        0.617
     13      60                  0.000687       50.754        0.706
                    0.000775                    49.844        0.795
     14      59                  0.000886       48.835        0.907
                    0.000996                    47.946        1.019
     15      58                  0.001135       46.962        1.160
                    0.001274                    46.092        1.301
     16      57                  0.001446       45.134        1.476
                    0.001619                    44.286        1.651
     17      56                  0.001834       43.355        1.868
                    0.002048                    42.529        2.085
     18      55                  0.002312       41.627        2.353
                    0.002576                    40.825        2.620
     19      54                  0.002900       39.951        2.948
                    0.003224                    39.173        3.276
     20      53                  0.003619       38.328        3.677
                    0.004013                    37.574        4.077
     21      52                  0.004492       36.759        4.562
                    0.004971                    36.030        5.047
     22      51                  0.005548       35.244        5.632
                    0.006126                    34.539        6.217
     23      50                  0.006818       33.782        6.918
                    0.007510                    33.101        7.620
     24      49                  0.008336       32.372        8.456
                    0.009162                    31.716        9.293
     25      48                  0.010141       31.015       10.285
                    0.011120                    30.382       11.277
     26      47                  0.012287       29.701       12.460
                    0.013455                    29.085       13.643
     27      46                  0.014844       28.423       15.050
                    0.016232                    27.824       16.457
     28      45                  0.017878       27.180       18.124
                    0.019523                    26.596       19.792
     29      44                  0.021467       25.971       21.761
                    0.023410                    25.402       23.730
     30      43                  0.025699       24.794       26.049
                    0.027987                    24.240       28.368
     31      42                  0.030673       23.648       31.089
                    0.033358                    23.108       33.810
     32      41                  0.036499       22.531       36.993
                    0.039641                    22.004       40.175
     33      40                  0.043326       21.438       43.910
                    0.047011                    20.920       47.644
     34      39                  0.051326       20.364       52.016
                    0.055641                    19.855       56.388
     35      38                  0.060682       19.309       61.496
                    0.065723                    18.807       66.603
     36      37                  0.071600       18.269       72.558
                    0.077477                    17.773       78.512
     37      36                  0.084313       17.243       85.439
                    0.091149                    16.753       92.366
     38      35                  0.099191       16.222      100.514
                    0.107233                    15.731      108.663
     39      34                  0.116695       15.198      118.250
                    0.126157                    14.706      127.837
     40      33                  0.137287       14.170      139.115
                    0.148418                    13.674      150.393
     41      32                  0.161513       13.134      163.661
                    0.174608                    12.633      176.930
     42      31                  0.190061       12.086      192.587
                    0.205513                    11.578      208.244
     43      30                  0.223772       11.021      226.745
                    0.242032                    10.504      245.246
     44      29                  0.263587        9.936      267.087
                    0.285142                     9.409      288.927
     45      28                  0.309854        8.846      313.966
                    0.334566                     8.320      339.005
     46      27                  0.353349        7.943      358.038
                    0.372133                     7.582      377.070
     47      26                  0.390927        7.237      396.112
                    0.409720                     6.905      415.155
     48      25                  0.428528        6.585      434.212
                    0.447337                     6.277      453.269
     49      24                  0.466153        5.980      472.335
                    0.484970                     5.692      491.401
     50      23                  0.503795        5.413      510.475
                    0.522620                     5.142      529.550
     51      22                  0.541449        4.879      548.628
                    0.560278                     4.623      567.706
     52      21                  0.579115        4.375      586.793
                    0.597953                     4.132      605.880
     53      20                  0.616790        3.896      624.967
                    0.635628                     3.665      644.054
     54      19                  0.654471        3.439      663.146
                    0.673314                     3.219      682.239
     55      18                  0.685878        3.074      694.969
                    0.698442                     2.932      707.699
     56      17                  0.711006        2.792      720.429
                    0.723570                     2.654      733.160
     57      16                  0.736134        2.517      745.890
                    0.748698                     2.382      758.621
     58      15                  0.761265        2.249      771.354
                    0.773832                     2.118      784.088
     59      14                  0.786400        1.988      796.822
                    0.798967                     1.860      809.556
     60      13                  0.809021        1.759      819.743
                    0.819075                     1.659      829.929
     61      12                  0.826616        1.584      837.570
                    0.834157                     1.510      845.211
     62      11                  0.841698        1.436      852.852
                    0.849239                     1.363      860.493
     63      10                  0.856781        1.290      868.135
                    0.864323                     1.218      875.776
     64       9                  0.871864        1.146      883.418
                    0.879406                     1.075      891.059
     65       8                  0.886948        1.004      898.701
                    0.894489                     0.934      906.342
     66       7                  0.902031        0.864      913.984
                    0.909573                     0.795      921.626
     67       6                  0.917116        0.726      929.268
                    0.924658                     0.657      936.911
     68       5                  0.932200        0.589      944.553
                    0.939743                     0.521      952.195
     69       4                  0.947285        0.454      959.837
                    0.954828                     0.387      967.480
     70       3                  0.962370        0.320      975.122
                    0.969913                     0.254      982.765
     71       2                  0.977456        0.189      990.408
                    0.984999                     0.123      998.051
     72       1                  0.992500        0.058     1005.650
                    1.000000                    -0.006     1013.250
